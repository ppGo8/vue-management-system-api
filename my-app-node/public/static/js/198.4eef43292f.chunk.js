(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[198],{36142:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return n}});s(57658);var l=s(81354),a=s.n(l),i=(s(16988),{name:"UploadFile",data(){return{tagClose:!0,percentage:0,smallFiles:[],smallUploader:[],file:[],text:""}},methods:{handleClickSmall(){this.$refs.smallUploader.click()},smallFileChange(e){e.target.files.length>1?this.smallFiles=this.smallFiles.concat(Object.values(e.target.files).slice(0,e.target.files.length)):1===e.target.files.length&&this.smallFiles.push(e.target.files[0])},async submitSmall(){if(0===this.smallFiles.length)return this.$message.error("请选择文件");this.smallFiles.forEach((e=>{const t=new FormData;t.append(e.name+"file",e),this.$axios.post("/api/smallUploader",t)})),this.smallFiles=[],this.$message.success("文件上传成功!")},deleteFile(){this.file=[]},deleteSmallFile(e){const t=e.name,s=[];for(let e=0;e<this.smallFiles.length;e++)this.smallFiles[e].name!==t&&s.push(this.smallFiles[e]);this.smallFiles=s},handleClick(){this.$refs.uploader.click()},async submit(){const e=this.file;if(0===e.length&&0===this.percentage)return this.$message.error("请选择文件");if(!e)return void(100===this.percentage&&(this.text="",this.percentage=0));this.file=[];const t=await this.read(e),s=a().MD5(t),{size:l,name:i,type:n}=e;let r=0;localStorage.getItem(s)&&(r=Number(localStorage.getItem(s))),this.text=i+" 文件上传中...";for(;r<l;){const t=e.slice(r,r+65536,n),a=new FormData;a.append("hash",s),a.append("name",i),a.append("type",n),a.append("size",l),a.append("offset",r),a.append("file",t);try{await this.$axios.post("/api/upload",a)}catch(e){return void(this.text=i+" 文件上传失败!"+e.message)}r+=t.size,localStorage.setItem(s,r),this.percentage=parseInt(r/l*100)}this.text=i+" 文件上传成功",localStorage.removeItem(s)},async fileChange(e){if(0!==this.percentage)return 100===this.percentage?(this.percentage=0,void(this.file=e.target.files[0])):void(0!==this.percentage&&this.$message.warning("请等待当前文件上传成功!"));this.file=e.target.files[0]},read(e){const t=new FileReader;return t.readAsBinaryString(e),new Promise(((e,s)=>{t.onload=function(){e(t.result)},t.onerror=function(){s(t.result)}}))}}}),n=(0,s(51900).Z)(i,(function(){var e=this,t=e._self._c;return t("div",[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-card",{attrs:{shadow:"hover"}},[t("span",[e._v("小文件上传——支持多文件上传")]),e._v(" "),t("el-divider"),e._v(" "),t("div",{staticClass:"btnfile"},[t("input",{ref:"smallUploader",attrs:{type:"file",multiple:""},on:{change:e.smallFileChange}}),e._v(" "),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.handleClickSmall}},[e._v("选择文件")])],1),e._v(" "),t("div",{staticClass:"file-list"},e._l(e.smallFiles,(function(s){return t("el-tag",{key:s.name,attrs:{"disable-transitions":e.tagClose,closable:""},on:{close:function(t){return e.deleteSmallFile(s)}}},[e._v("\n            "+e._s(s.name)+"\n          ")])})),1),e._v(" "),t("div",{staticClass:"btn"},[t("el-button",{ref:"btnSmall",attrs:{type:"primary",size:"mini"},on:{click:e.submitSmall}},[e._v("上传")])],1)],1)],1),e._v(" "),t("el-col",{attrs:{span:12}},[t("el-card",{attrs:{shadow:"hover"}},[t("span",[e._v("大文件上传——支持断点续传")]),e._v(" "),t("el-divider"),e._v(" "),t("div",{staticClass:"btnfile"},[t("input",{ref:"uploader",attrs:{type:"file"},on:{change:e.fileChange}}),e._v(" "),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.handleClick}},[e._v("选择文件")])],1),e._v(" "),t("div",{staticClass:"file-list"},[e.file.name?t("el-tag",{attrs:{closable:"","disable-transitions":e.tagClose},on:{close:e.deleteFile}},[e._v("\n            "+e._s(e.file.name)+"\n          ")]):e._e()],1),e._v(" "),0!==e.percentage?t("div",[t("el-progress",{staticClass:"progress",attrs:{"text-inside":!0,"stroke-width":26,percentage:e.percentage}}),e._v(" "),t("p",{staticClass:"text"},[e._v(e._s(e.text))])],1):e._e(),e._v(" "),t("div",{staticClass:"btn"},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.submit}},[e._v("上传")])],1)],1)],1)],1)],1)}),[],!1,null,"3d2cb373",null).exports},42480:function(){}}]);
//# sourceMappingURL=198.4eef43292f.chunk.js.map