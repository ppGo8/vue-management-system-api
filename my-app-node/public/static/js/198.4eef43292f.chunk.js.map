{"version":3,"file":"static/js/198.4eef43292f.chunk.js","mappings":"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","sources":["webpack://my-app/./src/views/UploadFile.vue","webpack://my-app/./src/views/UploadFile.vue?d7eb","webpack://my-app/src/views/UploadFile.vue","webpack://my-app/./src/views/UploadFile.vue?5de6"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',[_c('el-row',[_c('el-col',{attrs:{\"span\":12}},[_c('el-card',{attrs:{\"shadow\":\"hover\"}},[_c('span',[_vm._v(\"小文件上传——支持多文件上传\")]),_vm._v(\" \"),_c('el-divider'),_vm._v(\" \"),_c('div',{staticClass:\"btnfile\"},[_c('input',{ref:\"smallUploader\",attrs:{\"type\":\"file\",\"multiple\":\"\"},on:{\"change\":_vm.smallFileChange}}),_vm._v(\" \"),_c('el-button',{attrs:{\"type\":\"primary\",\"size\":\"mini\"},on:{\"click\":_vm.handleClickSmall}},[_vm._v(\"选择文件\")])],1),_vm._v(\" \"),_c('div',{staticClass:\"file-list\"},_vm._l((_vm.smallFiles),function(item){return _c('el-tag',{key:item.name,attrs:{\"disable-transitions\":_vm.tagClose,\"closable\":\"\"},on:{\"close\":function($event){return _vm.deleteSmallFile(item)}}},[_vm._v(\"\\n            \"+_vm._s(item.name)+\"\\n          \")])}),1),_vm._v(\" \"),_c('div',{staticClass:\"btn\"},[_c('el-button',{ref:\"btnSmall\",attrs:{\"type\":\"primary\",\"size\":\"mini\"},on:{\"click\":_vm.submitSmall}},[_vm._v(\"上传\")])],1)],1)],1),_vm._v(\" \"),_c('el-col',{attrs:{\"span\":12}},[_c('el-card',{attrs:{\"shadow\":\"hover\"}},[_c('span',[_vm._v(\"大文件上传——支持断点续传\")]),_vm._v(\" \"),_c('el-divider'),_vm._v(\" \"),_c('div',{staticClass:\"btnfile\"},[_c('input',{ref:\"uploader\",attrs:{\"type\":\"file\"},on:{\"change\":_vm.fileChange}}),_vm._v(\" \"),_c('el-button',{attrs:{\"type\":\"primary\",\"size\":\"mini\"},on:{\"click\":_vm.handleClick}},[_vm._v(\"选择文件\")])],1),_vm._v(\" \"),_c('div',{staticClass:\"file-list\"},[(_vm.file.name)?_c('el-tag',{attrs:{\"closable\":\"\",\"disable-transitions\":_vm.tagClose},on:{\"close\":_vm.deleteFile}},[_vm._v(\"\\n            \"+_vm._s(_vm.file.name)+\"\\n          \")]):_vm._e()],1),_vm._v(\" \"),(_vm.percentage !== 0)?_c('div',[_c('el-progress',{staticClass:\"progress\",attrs:{\"text-inside\":true,\"stroke-width\":26,\"percentage\":_vm.percentage}}),_vm._v(\" \"),_c('p',{staticClass:\"text\"},[_vm._v(_vm._s(_vm.text))])],1):_vm._e(),_vm._v(\" \"),_c('div',{staticClass:\"btn\"},[_c('el-button',{attrs:{\"type\":\"primary\",\"size\":\"mini\"},on:{\"click\":_vm.submit}},[_vm._v(\"上传\")])],1)],1)],1)],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-7!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UploadFile.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-7!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UploadFile.vue?vue&type=script&lang=js&\"","<template>\r\n  <div>\r\n    <el-row>\r\n      <el-col :span=\"12\">\r\n        <!-- 单/多文件上传 -->\r\n        <el-card shadow=\"hover\">\r\n          <span>小文件上传——支持多文件上传</span>\r\n          <el-divider></el-divider>\r\n          <div class=\"btnfile\">\r\n            <input\r\n              type=\"file\"\r\n              ref=\"smallUploader\"\r\n              @change=\"smallFileChange\"\r\n              multiple\r\n            />\r\n            <el-button @click=\"handleClickSmall\" type=\"primary\" size=\"mini\"\r\n              >选择文件</el-button\r\n            >\r\n          </div>\r\n\r\n          <div class=\"file-list\">\r\n            <el-tag\r\n              :disable-transitions=\"tagClose\"\r\n              v-for=\"item in smallFiles\"\r\n              :key=\"item.name\"\r\n              closable\r\n              @close=\"deleteSmallFile(item)\"\r\n            >\r\n              {{ item.name }}\r\n            </el-tag>\r\n          </div>\r\n          <div class=\"btn\">\r\n            <el-button\r\n              @click=\"submitSmall\"\r\n              type=\"primary\"\r\n              size=\"mini\"\r\n              ref=\"btnSmall\"\r\n              >上传</el-button\r\n            >\r\n          </div>\r\n        </el-card>\r\n      </el-col>\r\n      <el-col :span=\"12\">\r\n        <!-- 大文件上传 -->\r\n        <el-card shadow=\"hover\">\r\n          <span>大文件上传——支持断点续传</span>\r\n          <el-divider></el-divider>\r\n          <div class=\"btnfile\">\r\n            <input type=\"file\" ref=\"uploader\" @change=\"fileChange\" />\r\n            <el-button @click=\"handleClick\" type=\"primary\" size=\"mini\"\r\n              >选择文件</el-button\r\n            >\r\n          </div>\r\n          <div class=\"file-list\">\r\n            <el-tag\r\n              closable\r\n              v-if=\"file.name\"\r\n              @close=\"deleteFile\"\r\n              :disable-transitions=\"tagClose\"\r\n            >\r\n              {{ file.name }}\r\n            </el-tag>\r\n          </div>\r\n          <div v-if=\"percentage !== 0\">\r\n            <el-progress\r\n              :text-inside=\"true\"\r\n              :stroke-width=\"26\"\r\n              :percentage=\"percentage\"\r\n              class=\"progress\"\r\n            ></el-progress>\r\n            <p class=\"text\">{{ text }}</p>\r\n          </div>\r\n\r\n          <div class=\"btn\">\r\n            <el-button @click=\"submit\" type=\"primary\" size=\"mini\"\r\n              >上传</el-button\r\n            >\r\n          </div>\r\n        </el-card>\r\n      </el-col>\r\n    </el-row>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport CryptoJS from \"crypto-js\";\r\nimport { zrUtil } from \"echarts\";\r\nexport default {\r\n  name: \"UploadFile\",\r\n  data() {\r\n    return {\r\n      tagClose: true,\r\n      percentage: 0,\r\n      // 小文件\r\n      smallFiles: [],\r\n      smallUploader: [],\r\n      file: [], // 大文件\r\n      text: \"\",\r\n    };\r\n  },\r\n  methods: {\r\n    // 点击上传文件按钮\r\n    handleClickSmall() {\r\n      this.$refs.smallUploader.click();\r\n    },\r\n    // 选择小文件\r\n    smallFileChange(e) {\r\n      if (e.target.files.length > 1) {\r\n        this.smallFiles = this.smallFiles.concat(\r\n          Object.values(e.target.files).slice(0, e.target.files.length)\r\n        );\r\n        return;\r\n      }\r\n      if (e.target.files.length === 1) {\r\n        this.smallFiles.push(e.target.files[0]);\r\n      } else {\r\n        return;\r\n      }\r\n    },\r\n    // 上传小文件\r\n    async submitSmall() {\r\n      if (this.smallFiles.length === 0)\r\n        return this.$message.error(\"请选择文件\");\r\n\r\n      this.smallFiles.forEach((item) => {\r\n        const _formData = new FormData();\r\n        _formData.append(item.name + \"file\", item);\r\n        this.$axios.post(\"/api/smallUploader\", _formData);\r\n      });\r\n\r\n      // 清空文件\r\n      this.smallFiles = [];\r\n      this.$message.success(\"文件上传成功!\");\r\n    },\r\n    // 删除上传的大文件\r\n    deleteFile() {\r\n      this.file = [];\r\n    },\r\n    // 删除某个上传的文件\r\n    deleteSmallFile(item) {\r\n      const deletename = item.name;\r\n      const newArr = [];\r\n      for (let i = 0; i < this.smallFiles.length; i++) {\r\n        if (this.smallFiles[i].name !== deletename) {\r\n          newArr.push(this.smallFiles[i]);\r\n        }\r\n      }\r\n      this.smallFiles = newArr;\r\n    },\r\n    // 点击选择文件按钮——大文件\r\n    handleClick() {\r\n      this.$refs.uploader.click();\r\n    },\r\n    // 用户上传大文件,\r\n    async submit() {\r\n      const file = this.file;\r\n      if (file.length === 0 && this.percentage === 0)\r\n        return this.$message.error(\"请选择文件\");\r\n      if (!file) {\r\n        if (this.percentage === 100) {\r\n          this.text = \"\";\r\n          this.percentage = 0;\r\n        }\r\n        return;\r\n      }\r\n      // 清空删除文件的tag\r\n      this.file = [];\r\n      // 文件转换为二进制文件,生成hash作为文件唯一标识\r\n      const content = await this.read(file);\r\n      const hash = CryptoJS.MD5(content);\r\n\r\n      const { size, name, type } = file;\r\n      const chunkSize = 64 * 1024; // 每次上传的分片文件大小\r\n      let uploaded = 0; // 上传进度:已经上传的文件大小\r\n      // 每次在本地存储中读取当前的上传进度；这样可以进行断点传续\r\n      if (localStorage.getItem(hash)) {\r\n        uploaded = Number(localStorage.getItem(hash));\r\n      }\r\n      this.text = name + \" 文件上传中...\";\r\n      const breakpoint = 2000 * 1024; // 1MB\r\n      while (uploaded < size) {\r\n        // 每次要上传的分片文件\r\n        const chunk = file.slice(uploaded, uploaded + chunkSize, type);\r\n        const _formData = new FormData();\r\n        _formData.append(\"hash\", hash);\r\n        _formData.append(\"name\", name);\r\n        _formData.append(\"type\", type);\r\n        _formData.append(\"size\", size);\r\n        _formData.append(\"offset\", uploaded);\r\n        _formData.append(\"file\", chunk);\r\n\r\n        try {\r\n          await this.$axios.post(\"/api/upload\", _formData);\r\n        } catch (e) {\r\n          this.text = name + \" 文件上传失败!\" + e.message;\r\n          return;\r\n        }\r\n\r\n        // 更改上传进度\r\n        uploaded += chunk.size;\r\n        // 保存当前上传进度,可以断点续传\r\n        localStorage.setItem(hash, uploaded);\r\n        this.percentage = parseInt(100 * (uploaded / size));\r\n        // 断点续传测试\r\n        // if (uploaded > breakpoint) {\r\n        //   return;\r\n        // }\r\n      }\r\n      this.text = name + \" 文件上传成功\";\r\n      // 清除上传成功的文件的进度\r\n      localStorage.removeItem(hash);\r\n    },\r\n    // 用户选择大文件\r\n    async fileChange(e) {\r\n      if (this.percentage === 0) {\r\n        this.file = e.target.files[0];\r\n        return;\r\n      }\r\n      if (this.percentage === 100) {\r\n        this.percentage = 0;\r\n        this.file = e.target.files[0]; // 获得第一个文件\r\n        return;\r\n      }\r\n      if (this.percentage !== 0) {\r\n        this.$message.warning(\"请等待当前文件上传成功!\");\r\n      }\r\n    },\r\n    // 读取文件为二进制字符串类型\r\n    read(file) {\r\n      const reader = new FileReader();\r\n      // 读取file文件返回二进制文件\r\n      reader.readAsBinaryString(file);\r\n      return new Promise((resolve, reject) => {\r\n        // 读取成功\r\n        reader.onload = function () {\r\n          resolve(reader.result);\r\n        };\r\n        // 读取失败\r\n        reader.onerror = function () {\r\n          reject(reader.result);\r\n        };\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.btnfile {\r\n  width: 88px;\r\n  overflow: hidden;\r\n}\r\ninput[type=\"file\"] {\r\n  display: none;\r\n  z-index: -999;\r\n}\r\n.el-card {\r\n  margin: 50px;\r\n  padding: 20px;\r\n\r\n  .el-progress {\r\n    margin-top: 20px;\r\n    margin-bottom: 10px;\r\n  }\r\n  .el-button {\r\n    margin-top: 10px;\r\n  }\r\n  .small-text,\r\n  .text {\r\n    font-size: 12px;\r\n    color: #778899;\r\n  }\r\n  .small-text {\r\n    margin-top: 20px;\r\n  }\r\n}\r\n\r\n.el-tag {\r\n  margin-top: 10px;\r\n  margin-right: 5px;\r\n}\r\n</style>","import { render, staticRenderFns } from \"./UploadFile.vue?vue&type=template&id=3d2cb373&scoped=true&\"\nimport script from \"./UploadFile.vue?vue&type=script&lang=js&\"\nexport * from \"./UploadFile.vue?vue&type=script&lang=js&\"\nimport style0 from \"./UploadFile.vue?vue&type=style&index=0&id=3d2cb373&prod&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3d2cb373\",\n  null\n  \n)\n\nexport default component.exports"],"names":["name","data","tagClose","percentage","smallFiles","smallUploader","file","text","methods","handleClickSmall","$refs","click","smallFileChange","e","target","files","length","concat","Object","values","slice","push","submitSmall","$message","error","forEach","item","_formData","FormData","append","$axios","post","success","deleteFile","deleteSmallFile","deletename","newArr","i","handleClick","uploader","submit","content","read","hash","CryptoJS","size","type","uploaded","localStorage","getItem","Number","chunk","message","setItem","parseInt","removeItem","fileChange","warning","reader","FileReader","readAsBinaryString","Promise","resolve","reject","onload","result","onerror","_vm","this","_c","_self","attrs","_v","staticClass","ref","on","_l","key","$event","_s","_e"],"sourceRoot":""}